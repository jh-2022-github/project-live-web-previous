![header](https://capsule-render.vercel.app/api?type=waving&color=auto&height=300&section=header&text=PROJECT.%20Livecommerce%20&fontSize=60&animation=fadeIn&fontAlignY=38&desc=Livecommerce%20Website%20clone%20project&descAlignY=51&descAlign=62)


# PROJECT. ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ì›¹ì‚¬ì´íŠ¸ í´ë¡  í”„ë¡œì íŠ¸ğŸ’»

> 2021.05.16 - 07.20  
> ê°œë°œì¸ì› : 1ëª…
>
> ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ì„œë¹„ìŠ¤ë¡œ ì¤‘ì ì„ ë‘ì–´ í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•˜ì˜€ìœ¼ë©°, ë„¤ì´ë²„ ì‡¼í•‘ë¼ì´ë¸Œì˜ ê¸°ëŠ¥ê³¼ ì›¹ ë””ìì¸ì„ ê°œì¸ì ìœ¼ë¡œ ë¶„ì„í•´ í´ë¡  ì½”ë”© í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

## â“ ëª©ì°¨

### 1. í”„ë¡œì íŠ¸ ì†Œê°œ    
> 1-1.  [í”„ë¡œì íŠ¸ ì œì‘ ê³„ê¸°](#1-1-í”„ë¡œì íŠ¸-ì œì‘-ê³„ê¸°) 
> 1-2.  [í”„ë¡œì íŠ¸ ì£¼ìš” ê¸°ëŠ¥](#1-2-í”„ë¡œì íŠ¸-ì£¼ìš”-ê¸°ëŠ¥)  
> 1-3.  [ê°œë°œ í™˜ê²½](#1-3-ê°œë°œ-í™˜ê²½)  
> 1-4.  [DB ëª¨ë¸ë§](#1-4-DB-ëª¨ë¸ë§)  
> 1-5.  [ì‹¤í–‰ ì˜ìƒ](#1-5-ì‹¤í–‰-ì˜ìƒ)  

### 2. í”„ë¡œì íŠ¸ ê¸°ëŠ¥
#### 2-1. ë¡œê·¸ì¸ ì„œë¹„ìŠ¤  
> 2-1-1. [ë¡œê·¸ì¸ì— ë”°ë¥¸ ê¶Œí•œ ì²˜ë¦¬](#2-1-1-ë¡œê·¸ì¸ì—-ë”°ë¥¸-ê¶Œí•œ-ì²˜ë¦¬)  
> 2-1-2. [OAuth2ì™€ JPAë¥¼ ì´ìš©í•œ SNS ë¡œê·¸ì¸](#2-1-2-OAuth2ì™€-JPAë¥¼-ì´ìš©í•œ-SNS-ë¡œê·¸ì¸)  
#### 2-2. ë¼ì´ë¸Œ ì„œë¹„ìŠ¤
> 2-2-1. [Nginx ì„¤ì •í•˜ê¸°](#2-2-1-Nginx-ì„¤ì •í•˜ê¸°)  
> 2-2-2. [Obs ì‚¬ìš©í•˜ê¸°](#2-2-2-Obs-ì‚¬ìš©í•˜ê¸°)  
> 2-2-3. [ë¼ì´ë¸Œ ì˜ìƒ ì¶œë ¥](#2-2-3-ë¼ì´ë¸Œ-ì˜ìƒ-ì¶œë ¥)  
> 2-2-4. [ffemegë¡œ ë¼ì´ë¸Œ ì˜ìƒ ì¶”ì¶œí•´ S3ì— ì˜¬ë¦¬ê¸°](#2-2-4-ffemegë¡œ-ë¼ì´ë¸Œ-ì˜ìƒ-ì¶”ì¶œí•´-S3ì—-ì˜¬ë¦¬ê¸°)  
> 2-2-5. [ë¼ì´ë¸Œ ì¢…ë£Œ í›„ ì¶”ì¶œí•œ ì˜ìƒ ë³´ì—¬ì£¼ê¸°](#2-2-5-ë¼ì´ë¸Œ-ì¢…ë£Œ-í›„-ì¶”ì¶œí•œ-ì˜ìƒ-ë³´ì—¬ì£¼ê¸°)
#### 2-3. ì±„íŒ… ì„œë¹„ìŠ¤
> 2-3-1. [ë¼ì´ë¸Œ ì±„íŒ…ë°©](#2-3-1-ë¼ì´ë¸Œ-ì±„íŒ…ë°©)  
> 2-3-2. [ì±„íŒ…ë°© ì¸ì›ìˆ˜ í‘œì‹œ](#2-3-2-ì±„íŒ…ë°©-ì¸ì›ìˆ˜-í‘œì‹œ)
#### 2-4. ë©”ì¸ í˜ì´ì§€
#### 2-4. ì¥ë°”êµ¬ë‹ˆ 
> 2-4-1. [ì—…ì²´ë³„ í•©ê³„ ë° ë°°ì†¡ë¹„ ì²˜ë¦¬](#2-4-1-ì—…ì²´ë³„-í•©ê³„-ë°-ë°°ì†¡ë¹„-ì²˜ë¦¬)
#### 2-5. ê²°ì œ ì„œë¹„ìŠ¤
> 2-5-1. [ì•„ì„í¬íŠ¸ APIë¥¼ ì´ìš©í•œ ê²°ì œ ê¸°ëŠ¥](#2-5-1-ì•„ì„í¬íŠ¸-APIë¥¼-ì´ìš©í•œ-ê²°ì œ-ê¸°ëŠ¥)
#### 2-6. êµ¬ë§¤ë‚´ì—­
> 2-6-1. [êµ¬ë§¤ ìƒíƒœë³„ ìˆ˜ êµ¬í•˜ê¸°](#)
#### 2-7. íŒë§¤ì ê¸°ëŠ¥
> 2-7-1. [ìƒí’ˆ ë“±ë¡ ë° íŒë§¤ê¸€ ë“±ë¡](#2-7-1-ìƒí’ˆ-ë“±ë¡-ë°-íŒë§¤ê¸€-ë“±ë¡)  
> 2-7-2. [ë¼ì´ë¸Œ ë“±ë¡](#2-7-2-ë¼ì´ë¸Œ-ë“±ë¡)  
> 2-7-3. [íŒë§¤ë‚´ì—­ ê²°ì œ ë° ì£¼ë¬¸ìƒíƒœ](#2-7-3-íŒë§¤ë‚´ì—­-ê²°ì œ-ë°-ì£¼ë¬¸ìƒíƒœ)  

### 3. AWS
*** ì¶” í›„ ë¸”ë¡œê·¸ì— ì •ë¦¬í•  ì˜ˆì •
(https://github.com/onealog)

### 4. ë§ˆë¬´ë¦¬
> 3-1. ì•„ì‰¬ì› ë˜ ì / ì¢‹ì•˜ë˜ ì 
> 3-2. ë§ˆë¬´ë¦¬ ì†Œê°
---
---
# 1. í”„ë¡œì íŠ¸ ì†Œê°œ
## 1-1. í”„ë¡œì íŠ¸ ì†Œê°œ
* ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•´ë³´ê³  ì‹¶ì–´ì„œ ì²˜ìŒì—ëŠ” ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•´ë³¼ê¹Œ í•˜ë‹¤ ìµœê·¼ ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ê°€ í˜„ì¬ í° ê´€ì‹¬ ì¤‘ í•˜ë‚˜ë¼ ìƒê°í•˜ì—¬ ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ì›¹ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

* ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ì˜ ì¥ì ì¸ í¸ì˜ì„±ê³¼ ì†Œí†µì„±ì„ ìœ„í•´ ì‹¤ì‹œê°„ ì˜ìƒê³¼ ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì„ ë„£ì–´ ì œí’ˆì— ëŒ€í•œ ì •ë³´ë¥¼ ë°”ë¡œ ë³´ì—¬ì£¼ë©´ì„œ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì„ ë°”ë¡œ ì•Œë ¤ì¤„ ìˆ˜ ìˆê²Œ í•˜ì˜€ìœ¼ë©°, ì‹¤ì‹œê°„ ë°©ì†¡ì´ ëë‚˜ë„ í•´ë‹¹ ì˜ìƒì„ ë‹¤ì‹œ ë³´ì—¬ì¤Œìœ¼ë¡œì¨ ì†Œë¹„ìì—ê²Œ ì§€ì†ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ì—¬ íš¨ìœ¨ì„±ì„ ì¦ëŒ€ì‹œì¼°ìŠµë‹ˆë‹¤.

* ë˜í•œ ë¼ì´ë¸Œë¥¼ ë³´ë©´ì„œ êµ¬ë§¤í•  ìˆ˜ ìˆê²Œ í•˜ë‹¨ì— ì œí’ˆê¸€ì„ ëˆ„ë¥´ë©´ ì œí’ˆ ì†Œê°œ ë° êµ¬ë§¤ ì°½ì´ íŒì—… í˜•ì‹ìœ¼ë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ í•˜ì˜€ìœ¼ë©°, ë°”ë¡œ êµ¬ë§¤í•˜ê¸°ì™€ ì¥ë°”êµ¬ë‹ˆ ë„£ê¸° ë²„íŠ¼ì„ í•˜ë‹¨ì— ê³ ì •ì‹œì¼œ ì£¼ë¬¸í•˜ê¸° í¸í•˜ê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.

* ì†Œë¹„ìì˜ ë°°ì†¡ì§€ ì£¼ì†Œë¥¼ ê¸°ë³¸ ë°°ì†¡ì§€ì™€ ì¶”ê°€ë¡œ 4ê°œ ë” ì €ì¥í•  ìˆ˜ ìˆê²Œí•˜ì—¬ ì£¼ë¬¸ ì‹œ ìµœì†Œí•œì˜ í–‰ë™ìœ¼ë¡œ êµ¬ë§¤í•  ìˆ˜ ìˆê²Œ í–ˆìœ¼ë©°, ê²°ì œ APIë¥¼ ì‚¬ìš©í•´ ì‹ ìš©ì¹´ë“œ, ì¹´ì¹´ì˜¤í˜ì´, í† ìŠ¤ë¡œ êµ¬ë§¤í•  ìˆ˜ ìˆê²Œ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

* íŒë§¤ìê°€ ì œí’ˆì„ ê´€ë¦¬(ì¬ê³ ëŸ‰ ë“±)í•  ìˆ˜ ìˆê³  íŒë§¤ê¸€ì„ ì˜¬ë ¸ì„ ë•Œ ë™ì¼í•œ ìƒí’ˆì— ëŒ€í•œ ìƒí’ˆëª…ê³¼ ê¸ˆì•¡ì„ ë™ì¼ì‹œ í•˜ê¸° ìœ„í•´ ì œí’ˆ ë“±ë¡ê³¼ íŒë§¤ê¸€ ë“±ë¡ì„ êµ¬ë¶„í•˜ì˜€ìœ¼ë©° ë¼ì´ë¸Œ ë“±ë¡ì‹œ íŒë§¤ê¸€ì„ ì„ íƒí•´ ë™ì¼í•œ ì œí’ˆì„ ê³„ì† ë¼ì´ë¸Œ í•  ìˆ˜ ìˆê²Œ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ìŠ¤íŠ¸ë¦¼í‚¤ëŠ” ë…¸ì¶œì„ ë§‰ê¸° ìœ„í•´ ë§ˆìŠ¤í‚¹ ì²˜ë¦¬ë¥¼ í•˜ì˜€ê³  ì–¸ì œë“  ìŠ¤íŠ¸ë¦¼í‚¤ë¥¼ êµì²´í•  ìˆ˜ ìˆê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.

* í˜¼ì ìƒˆë¡­ê²Œ ê¸°íší•˜ê³  ì œì‘í•˜ê¸°ì—” ë§ì€ ê¸°ê°„ì´ ì†Œìš”ë  ê²ƒ ê°™ì•„ì„œ ì›¹ ë””ìì¸ê³¼ ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ëŠ” ë„¤ì´ë²„ ì‡¼í•‘ ë¼ì´ë¸Œë¥¼ ê°œì¸ì ìœ¼ë¡œ ë¶„ì„í•´ í´ë¡  ì½”ë”© í•˜ì˜€ìœ¼ë©°, ì¥ë°”êµ¬ë‹ˆ, êµ¬ë§¤í˜ì´ì§€ëŠ” ì˜¤ëŠ˜ì˜ ì‡¼í•‘ ì›¹ ë””ìì¸ì„ ì°¸ê³  í•˜ì˜€ìŠµë‹ˆë‹¤. 

## 1-2. ê°œë°œ í™˜ê²½ ğŸ›  
<img src="https://img.shields.io/badge/JAVA-FF4DAC?style=flat-square&logo=java&logoColor=white&width=300"> <img src="https://img.shields.io/badge/MySQL-B965DF?style=flat-square&logo=MySQL&logoColor=white"/> <img src="https://img.shields.io/badge/Spring Boot-758bfd?style=flat-square&logo=SpringBoot&logoColor=white"/> <img src="https://img.shields.io/badge/Spring Security-0083DE?style=flat-square&logo=Spring Security&logoColor=white"/> <img src="https://img.shields.io/badge/Apache Tomcat-21B88F?style=flat-square&logo=ApacheTomcat&logoColor=white"/> <img src="https://img.shields.io/badge/NGINX-007844?style=flat-square&logo=NGINX&logoColor=white"/>

<img src="https://img.shields.io/badge/FFmpeg-00BD8D?style=flat-square&logo=FFmpeg&logoColor=white"/> <img src="https://img.shields.io/badge/Socket.io-00B0D5?style=flat-square&logo=Socket.io&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon AWS-00A1FF?style=flat-square&logo=AmazonAWS&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon ECS-008CFF?style=flat-square&logo=Amazon ECS&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon S3-006BFF?style=flat-square&logo=Amazon S3&logoColor=white"/> 
<img src="https://img.shields.io/badge/Amazon RDS-4026FF?style=flat-square&logo=Amazon RDS&logoColor=white"/> 

<img src="https://img.shields.io/badge/HTML-FF911E?style=flat-square&logo=HTML5&logoColor=white"/> <img src="https://img.shields.io/badge/CSS3-FF7965?style=flat-square&logo=CSS3&logoColor=white"/> <img src="https://img.shields.io/badge/Javascript-FF4986?style=flat-square&logo=Javascript&logoColor=white"/> <img src="https://img.shields.io/badge/jQuery-FF26AC?style=flat-square&logo=jQuery&logoColor=white"/> <img src="https://img.shields.io/badge/Adobe Photoshop-B15AE9?style=flat-square&logo=Adobe Photoshop&logoColor=white"/> <img src="https://img.shields.io/badge/Adobe Illustrator-6E19DF?style=flat-square&logo=Adobe Illustrator&logoColor=white"/>

## 1-3. DB ëª¨ë¸ë§


## 1-4. ì‹¤í–‰ ì˜ìƒ

<br>

# 2. í”„ë¡œì íŠ¸ ê¸°ëŠ¥ ì„¤ëª…
## 2-1. ë¡œê·¸ì¸ ì„œë¹„ìŠ¤
> ë¡œê·¸ì¸ì€ form ë¡œê·¸ì¸ê³¼ OAuth2 ë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
### 2-1-1. WebSecurityConfig ì„¤ì •
* Spring Securityì— ë‹¤ì–‘í•œ ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ ì„¤ì • í•´ì¤ë‹ˆë‹¤.
```java
http.authorizeRequests()
      ...
      .and()
        .formLogin()                                    // formíƒœê·¸ ê¸°ë°˜ì˜ ë¡œê·¸ì¸
        .usernameParameter("userId")                    // id íŒŒë¼ë¯¸í„° ëª…
        .passwordParameter("userPw")                    // pw íŒŒë¼ë¯¸í„° ëª…
        .loginPage("/login")                            // ë¡œê·¸ì¸ í˜ì´ì§€
        .loginProcessingUrl("/loginProcess")            // ë¡œê·¸ì¸ ì²˜ë¦¬ URL
        .failureUrl("/login?error=true")                // ë¡œê·¸ì¸ ì‹¤íŒ¨ í›„ í˜ì´ì§€
        .failureHandler(authenticationFailureHandler)   // ë¡œê·¸ì¸ ì‹¤íŒ¨ í•¸ë“¤ëŸ¬
        .successHandler(authenticationSuccessHandler)   // ë¡œê·¸ì¸ ì„±ê³µ í•¸ë“¤ëŸ¬
        .permitAll()
      .and()
        .rememberMe()                                   // ìë™ë¡œê·¸ì¸
        .rememberMeParameter("rememberMe")              // ìë™ë¡œê·¸ì¸ íŒŒë¼ë¯¸í„° ëª…
        .tokenValiditySeconds(86400 * 30)               // ì¿ í‚¤ ë§Œë£Œ ì‹œê°„ ì„¤ì •(30ì¼)
        .userDetailsService(customUsersDetailService)   // ì‹œìŠ¤í…œì˜ ì‚¬ìš©ì ê³„ì •ì„ ì¡°íšŒí•  ë•Œ ì²˜ë¦¬ ì„¤ì •í•˜ëŠ” api
        .tokenRepository(tokenRepository())             //DataSource ì¶”ê°€
      .and()
        .logout()                                       // ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ì„¤ì • ì§„ì…ì 
        .logoutUrl("/logout")                           // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ URL
        .logoutSuccessUrl("/")                          // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ ì…ë ¥í•œ ì£¼ì†Œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        .invalidateHttpSession(true)                    // ì„¸ì…˜ ì •ë³´ ì‚­ì œ
        .deleteCookies("JSESSIONID","rememberMe")       //ë¡œê·¸ì•„ì›ƒ í›„ ìë™ ë¡œê·¸ì¸ ì¿ í‚¤ ì‚­ì œ
        .permitAll()
      ...
      .and()      
        .csrf()                                         //csrf ê³µê²©ì„ ë§‰ì•„ì£¼ëŠ” CsrfFilter ì œê³µ
        .ignoringAntMatchers("/loginProcess","/stomp/**")  // csrfì˜ˆì™¸ì²˜ë¦¬  
      .and()
        .oauth2Login()                                  //  OAuth2 ë¡œê·¸ì¸ ê¸°ëŠ¥ ì„¤ì • ì§„ì…ì 
        .loginPage("/login")
        .userInfoEndpoint()                             //  OAuth2 ë¡œê·¸ì¸ ì„±ê³µ ì´í›„ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¬ ì„¤ì • ë‹´ë‹¹
        .userService(customOAuth2UserService);          //  ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ í›„ ì²˜ë¦¬ êµ¬í˜„ì²´ ë“±ë¡
```
### 2-1-1. ë¡œê·¸ì¸ì— ë”°ë¥¸ ê¶Œí•œ ì²˜ë¦¬
* ìœ ì € ê¶Œí•œ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” enum í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³  DBì— ì €ì¥ëœ ìœ ì € ê¶Œí•œì˜ key ê°’ê³¼ ë¹„êµí•´ ìœ ì €ì˜ ê¶Œí•œ ê°’ì„ ë¶€ì—¬í•´ì¤€ë‹¤.
* ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬ì‹œì—ë„ ì‚¬ìš©ëœë‹¤.
```java
@Getter
@RequiredArgsConstructor
public enum UserRole {
    MEMBER("ROLE_MEMBER","11","ì •íšŒì›"), 
    EMPLOYEE("ROLE_EMPLOYEE","12","ê¸°ì—…íšŒì›"),
    ADMIN("ROLE_ADMIN","13","ê´€ë¦¬ì"), 
    UNKNOWN("UNKNOWN","",""),
    STOP("ROLE_STOP","99","ë¸”ëŸ­ê³„ì •");
    
    private final String role;
    private final String key;
    private final String title;
    ...
}
```

```java
   ... 
  /* ìœ ì € ê¶Œí•œ ì •ë³´ ë„£ê¸° */
  UserRole userRole =UserRole.fromRole(user.getUserRole());
  ArrayList<SimpleGrantedAuthority> authorities = new ArrayList<>();

  if(UserRole.MEMBER.getKey().equals(user.getUserRole())) {                         //UserRoleì˜ keyê°’ê³¼ DBì— ì €ì¥ëœ ìœ ì €ì˜ Role ê°’ì„ ë¹„êµí•´
      authorities.add(new SimpleGrantedAuthority(UserRole.MEMBER.getRole()));       //ì¼ì¹˜í•˜ëŠ” UserRole ê°’ì„ ë¶€ì—¬í•´ì¤€ë‹¤
  }else if(UserRole.EMPLOYEE.getKey().equals(user.getUserRole())) {
      authorities.add(new SimpleGrantedAuthority(UserRole.EMPLOYEE.getRole()));
  }else if(UserRole.ADMIN.getKey().equals(user.getUserRole())){
      authorities.add(new SimpleGrantedAuthority(UserRole.ADMIN.getRole()));
  }else if(UserRole.STOP.getKey().equals(user.getUserRole())) {
      authorities.add(new SimpleGrantedAuthority(UserRole.STOP.getRole()));
  }else{
      authorities.add(new SimpleGrantedAuthority(UserRole.UNKNOWN.getRole()));
  }
  ... 
```

### 2-1-2. OAuth2ì™€ JPAë¥¼ ì´ìš©í•œ SNS ë¡œê·¸ì¸
* OAuth2UserServiceë¥¼ ìƒì† ë°›ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ ë¡œê·¸ì¸ í•˜ë ¤ëŠ” SNS(ë„¤ì´ë²„, ì¹´ì¹´ì˜¤)ë¥¼ êµ¬ë¶„í•´ ê³„ì • ì •ë³´ë¥¼ ë°›ì•„ì™€ 
UserVo í˜•íƒœë¡œ ê°’ì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤. 

```java
...
//ì¹´ì¹´ì˜¤ ê³„ì • ì •ë³´ ê°€ì ¸ì˜¤ê¸°
private static OAuthAttributes ofKakao(String userNameAttributeName, Map<String, Object> attributes) {
        // ë°›ì•„ ì˜¨ kakao ì •ë³´ ì•ˆì— kakao_account ë‹´ê¸°
        Map<String, Object> kakaoAccount = (Map<String, Object>)attributes.get("kakao_account");
        // kakao_accountì•ˆì— profileì´ë¼ëŠ” JSONê°ì²´ ì •ë³´ë¥¼ ë‹´ëŠ”ë‹¤
        Map<String, Object> kakaoProfile = (Map<String, Object>)kakaoAccount.get("profile");
        return OAuthAttributes.builder()
                .userId((attributes.get("id"))+"@k")
                .userUname((String) kakaoProfile.get("nickname"))
                .userNickname((String) kakaoProfile.get("nickname"))
                .userPlatform("kakao")
                .userRole(UserRole.MEMBER.getKey())
                .attributes(attributes)
                .nameAttributeKey(userNameAttributeName)
                .build();
    }
...

```
* ë„˜ì–´ì˜¤ëŠ” ê°’ê³¼ DB ê°’ì„ ë¹„êµí•´ ì—†ìœ¼ë©´ ë°”ë¡œ íšŒì› ê°€ì… ì²˜ë¦¬ í•˜ì˜€ìœ¼ë©° DBì²˜ë¦¬ì—ëŠ” JPAë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
```java
...
//íšŒì›ê°€ì…
@Modifying 
@Query(value="INSERT INTO USER_INFO (USER_ID,USER_PW,USER_UNAME,USER_NICKNAME,USER_PLATFORM,USER_ROLE)VALUES(#{userId},#{userPw},#{userUname},#{userNickname},#{userPlatform},#{userRole}",nativeQuery = true)
int insertUserInfo(@Param("userId")String userId,@Param("userPw")String userPw,@Param("userUname")String userUname
            ,@Param("userNickname")String userNickname,@Param("userPlatform")String userPlatform,@Param("userRole")String userRole);
```
* UserVo í˜•íƒœë¡œ ê°’ì„ ë„£ì–´ ìœ ì € ì •ë³´ë¥¼ return í•˜ì—¬ formë¡œê·¸ì¸ê³¼ OAuth2ë¡œê·¸ì¸ì‹œ ì €ì¥í•˜ëŠ” ê³„ì • ì •ë³´ë¥¼ ë™ì¼í•œ ì½”ë“œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤.
* OAuth2Userì™€ UserDetailsë¥¼ ìƒì† ë°›ì•„ UserVoí˜•íƒœë¡œ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.
```java
public class UserVo implements OAuth2User,UserDetails{
...
    @Builder
    public UserVo(String userId,String userUname, String userNickname, String userPhone, String userRole,Collection<? extends GrantedAuthority> authorities) {
        this.userId = userId;
        this.userUname = userUname;
        this.userNickname = userNickname;
        this.userPhone = userPhone;
        this.userRole = userRole;
        this.authorities = authorities;
    }
...
}
```
## 2-2. ë¼ì´ë¸Œ ì„œë¹„ìŠ¤
> OBSì˜ ë°©ì†¡ ì„œë²„ë¥¼ ìœ„í•´ NGINX-RTMPë¥¼ ì‚¬ìš©í•˜ì˜€ìœ¼ë©° HTML5ì˜ Videoíƒœê·¸ë¡œ ìŠ¤íŠ¸ë¦¼ì„ ë°›ì•„ ì˜ìƒì„ ì¬ìƒì‹œí‚¬ ìˆ˜ ìˆê²Œ HLSë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.  
>
> ì‹¤ì‹œê°„ ì˜ìƒì„ ì¢…ë£Œ í›„ì—ë„ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ ffeng
### 2-2-1. Nginx-RTMP ì„¤ì •í•˜ê¸°
* ubuntuì— ì›í•˜ëŠ” ë²„ì „ì˜ Nginx-RTMPë¥¼ ë‹¤ìš´ ë°›ì•„ ì»´íŒŒì¼ëŸ¬í•´ ì„¤ì¹˜í•˜ê³  rtmpì†ŒìŠ¤ë¥¼ hlsë¡œ ë°”ê¾¸ê¸°ìœ„í•´ í™˜ê²½ ì„¤ì •ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
* conf íŒŒì¼ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ ì•„ë˜ ì£¼ì†Œ ì°¸ê³  
  * https://github.com/dreamsxin/nginx-rtmp-wiki/blob/master/Directives.md#record_path
```
rtmp {
    server {
	listen 1935;
	chunk_size 4096;
	access_log logs/rtmp_access.log;

	# obs ì ‘ì† ì„œë²„ ë’¤ì— /live ì…ë ¥
	application live {
		# ë¼ì´ë¸Œ ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™”
	      live on;
		# ì˜¤ë””ì˜¤ì™€ ë¹„ë””ì˜¤ ë°ì´í„° ë™ì¼í•œ RTMP ì²­í¬ ìŠ¤íŠ¸ë¦¼ ì „ì†¡
		interleave on;
		# /liveì˜ ë¼ì´ë¸Œì˜ìƒì„ ë‹¤ë¥¸ ì£¼ì†Œë¡œ ë°€ê¸°
		push rtmp://IPì£¼ì†Œ/hls;
            ...
		}
	application hls {
	        live on;
		# hls ì „í™˜
		hls on;
		# ìŠ¤íŠ¸ë¦¼ì— ëŒ€í•´ í•˜ìœ„ ë””ë ‰í† ë¦¬ ìƒì„±
		hls_nested on;
		# ì˜¤ë˜ëœ hls ì¡°ê°ê³¼ ì¬ìƒ ëª©ë¡ ì œê±°
		# í”„ë¦¬í‹°ì–´ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ê¼­ ì„¤ì •í•˜ê¸°
		hls_cleanup on;
		...
		}
	}
}
http {
	...
    	server {
		# ì—°ê²°í•  í¬íŠ¸
		listen		8050;	
		# ì—°ê²°í•  IPì£¼ì†Œ
		server_name	IPì£¼ì†Œ;
		...
		location /hls {
			...
           		 types {
               			 application/vnd.apple.mpegurl m3u8;
                               ...
            		}
            		root /tmp;
            		add_header Cache-Control no-cache;
            		add_header Access-Control-Allow-Origin *;
			...
			autoindex on;
			autoindex_localtime on;
			autoindex_exact_size off;
			# ìŠ¤íŠ¸ë¦¬ë°ì‹œ ì„ì‹œ ì €ì¥ë˜ëŠ” í´ë” ê²½ë¡œ
			alias /mnt/hls;	
			...
        	}
		...
	}
}
```
### 2-2-2. Obs ì‚¬ìš©í•˜ê¸°
* ì„¤ì • -> ë°©ì†¡ íƒ­ì—ì„œ ì ‘ì†í•  ì„œë²„ì™€ ë°©ì†¡ ì—´ì‡ ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
- ì„œë²„: `rtmp://IPì£¼ì†Œ ë˜ëŠ” ë„ë©”ì¸ ì£¼ì†Œ/live`   
- ë°©ì†¡ ì—´ì‡ : `íŒë§¤ìì—ê²Œ ë¶€ì—¬ëœ ìŠ¤íŠ¸ë¦¼í‚¤` 

### 2-2-3. ë¼ì´ë¸Œ ì˜ìƒ ì¶œë ¥
* hls.jsë¥¼ ì‚¬ìš©í•´ ë¼ì´ë¸Œ ì˜ìƒì„ 
```javascript
    //ë¼ì´ë¸Œ ì—°ê²°
    var video = document.getElementById('video');
    var videoSrc =url+"/hls/"+stream+"/index.m3u8";
    var hls = new Hls();
    if(status){
        if(video.canPlayType('application/vnd.apple.mpegurl')) {   // ìš°ì„  HLSë¥¼ ì§€ì›í•˜ëŠ”ì§€ ì²´í¬
            video.src = videoSrc;
        }else if(Hls.isSupported()){                         // HLSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ hls.jsë¥¼ ì§€ì›
            hls.loadSource(videoSrc);                       //ë¼ì´ë¸Œ ì˜ìƒ íŒŒì¼ ì£¼ì†Œ ë¶ˆëŸ¬ì˜¤ê¸°
            hls.attachMedia(video);                         //ë¹„ë””ì˜¤ íƒœê·¸ì— ë„£ê¸°
            hls.on(Hls.Events.MANIFEST_PARSED,()=>{
                video.play();                               //ë¼ì´ë¸Œ ì‹œì‘
                $('.LiveBadge_live').removeClass('blind');  //ë¼ì´ë¸Œë±ƒì§€ ë³´ì—¬ì£¼ê¸°
            })
            hls.on(Hls.Events.ERROR, function(data) {       //ë¼ì´ë¸Œ ì¢…ë£Œ ê°ì§€
                liveEnd();                                  //ì¢…ë£Œ ì²˜ë¦¬
            });
        }
    }else{
        liveEnd();
    }
```
### 2-2-4. ffemeg,FFfrobeë¡œ ë¼ì´ë¸Œ ì˜ìƒ ì¶”ì¶œí•´ S3ì— ì˜¬ë¦¬ê¸°
* í¬ë¡ ì‹ì„ ì‚¬ìš©í•´ 1ë¶„ë§ˆë‹¤ ë¼ì´ë¸Œë¥¼ ê°ì§€í•´ ë¼ì´ë¸Œ ì‹œì‘ ì‹œê°„ ë˜ëŠ” ì¢…ë£Œ ì‹œê°„ì— ë§ì¶° ë¼ì´ë¸Œ ìƒíƒœë¥¼ ë³€ê²½í•´ì¤ë‹ˆë‹¤.
* ìš©ëŸ‰ì— ë”°ë¥¸ ë¹„ìš©ì¶”ê°€ë¥¼ ë§‰ê¸° ìœ„í•´ ì˜ìƒíŒŒì¼ì€ 1ë¶„ë§Œ ì €ì¥í•˜ê²Œ í•˜ì˜€ê³  í˜„ì¬ ë¼ì´ë¸Œ ì¤‘ì´ë©´ì„œ ë¹„ë””ì˜¤ íŒŒì¼ì´ ì—†ëŠ” ë¼ì´ë¸Œë§Œ mp4íŒŒì¼ë¡œ ë³€í™˜í•´ AWS S3ì— ì €ì¥í•©ë‹ˆë‹¤.
```java
@Scheduled(cron="0 */1 * * * *")
public void liveVideoSave() throws IOException{
      ...
      // ubuntuì— ì„¤ì¹˜í•œ ffmpeg, ffprobeì˜ ê²½ë¡œë¥¼ ë„£ì–´ì„œ ì‚¬ìš©í•œë‹¤
      FFmpeg ffmpeg = new FFmpeg(ffmpegUrl);
      FFprobe ffprobe = new FFprobe(ffprobeUrl);
      ...
     // í˜„ì¬ ë¼ì´ë¸Œ ì¤‘ì´ë©´ì„œ ì €ì¥ëœ ì˜ìƒì´ ì—†ëŠ” ë¼ì´ë¸Œë§Œ ì‹¤í–‰í•œë‹¤.
     for(int i =0;i<live.size();i++) {            
            String key = live.get(i).getSelStreamKey();
            String liveId = createVideoName(live.get(i).getLiveId());
            // ë³€í™˜ ì„¤ì •
            FFmpegBuilder builder = new FFmpegBuilder()
                    .setInput(url+"/hls/"+key+"/index.m3u8") // íŒŒì¼ ê²½ë¡œ
                    .overrideOutputFiles(true)                                  // ì˜¤ë²„ë¼ì´ë“œ
                    .addOutput(uploadFolder+uploadFolderPath+"/"+liveId+".mp4") // ì €ì¥ê²½ë¡œ
                    .setVideoCodec("libx264")                                   // ë¹„ë””ì˜¤ì½”ë±
                    .disableSubtitle()                                          // ì„œë¸Œíƒ€ì´í‹€ ì œê±°
                    .setAudioChannels(2)                                        // ì˜¤ë””ì˜¤ì±„ë„(1: ëª¨ë…¸, 2:ìŠ¤í…Œë ˆì˜¤)
                    .addExtraArgs("-t", "00:01:00")                             // ì¸ì½”ë”©í•  ì‹œê°„ ì„¤ì •
                    //(-ss "00:00:00"ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë…¹í™” ì²˜ìŒë¶€í„° ì €ì¥ë˜ê³  -të¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ë°©ì†¡ëœ ì˜ìƒ ì „ì²´ ì €ì¥) 
                    .addExtraArgs("-c:a", "aac")                                // ì˜¤ë””ì˜¤ ì½”ë±
                    .addExtraArgs("-b:a", "192k")                               // ì˜¤ë””ì˜¤ ìŒì§ˆê°’
                    .setVideoResolution(1280, 720)                              // ë™ì˜ìƒ í•´ìƒë„
                    .setVideoBitRate(1464800)                                   // ë¹„ë””ì˜¤ ë¹„íŠ¸ë ˆì´íŠ¸
                    .setStrict(FFmpegBuilder.Strict.EXPERIMENTAL)               // ffmpeg ë¹Œí„° ì‹¤í–‰ í—ˆìš©
                    .done();
            FFmpegExecutor executor = new FFmpegExecutor(ffmpeg,ffprobe);             
            executor.createJob(builder).run();
            ...
            //ìœ„ì¹˜í•œ ì˜ìƒ ì£¼ì†Œë¥¼ Fileì— ë„£ì–´ S3ì— ì €ì¥í•œë‹¤
            File file = new File(uploadFolderUrl+uploadFolderPath+liveVideoVo.getVideoName());
            awsS3Service.uploadFile(file, uploadFolderPath,liveId.substring(1)+".mp4");
            
        }
```

### 2-2-5. ë¼ì´ë¸Œ ì¢…ë£Œ í›„ ì¶”ì¶œí•œ ì˜ìƒ ë³´ì—¬ì£¼ê¸°
* ë¼ì´ë¸Œ ì˜ìƒì„ ì €ì¥í•´ ë¼ì´ë¸Œ ì¢…ë£Œ í›„ì—ë„ ê³„ì† ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
```html
<video class="VideoPlayer_video replayVideo" autoplay muted loop poster="https://s3.ap-northeast-2.amazonaws.com/S3ë²„í‚·ëª…/ì €ì¥ëœ ê²½ë¡œ/íŒŒì¼ëª…>
      <source src="https://s3.ap-northeast-2.amazonaws.com/S3ë²„í‚·ëª…/ì €ì¥ëœ ê²½ë¡œ/íŒŒì¼ëª…" type="video/mp4">
</video>
```
