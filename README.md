![header](https://capsule-render.vercel.app/api?type=waving&color=auto&height=300&section=header&text=PROJECT.%20Livecommerce%20&fontSize=60&animation=fadeIn&fontAlignY=38&desc=Livecommerce%20Website%20clone%20project&descAlignY=51&descAlign=62)


# PROJECT. ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ì›¹ì‚¬ì´íŠ¸ í´ë¡  í”„ë¡œì íŠ¸ğŸ’»

> 2021.05.16 - 07.20  
> ê°œë°œì¸ì› : 1ëª…
>
> ìµœê·¼ ë¹„ëŒ€ë©´ì´ ì¼ìƒí™”ë˜ë©´ì„œ ìì—°ìŠ¤ë ˆ ì–¸íƒíŠ¸ ì‹œëŒ€ë¥¼ ë§ì´í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¡œì¸í•´ ì˜¨ë¼ì¸ ì‡¼í•‘ì´ í¬ê²Œ ì„±ì¥ í•˜ì˜€ê³  í˜„ì¬ ë¼ì´ë¸Œì»¤ë¨¸ìŠ¤ê°€ í° ê´€ì‹¬ì„ ë°›ê³  ìˆìŠµë‹ˆë‹¤.   
>
> ê·¸ë˜ì„œ ì´ë²ˆ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ì„œë¹„ìŠ¤ë¡œ ì¤‘ì ì„ ë‘ì–´ ê°œë°œí•˜ì˜€ìŠµë‹ˆë‹¤.  ë„¤ì´ë²„ ì‡¼í•‘ ë¼ì´ë¸Œì˜ ê¸°ëŠ¥ê³¼ ì›¹ ë””ìì¸ì„ ê°œì¸ì ìœ¼ë¡œ ë¶„ì„í•´ í´ë¡  ì½”ë”© í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

## â“ ëª©ì°¨

### 1. í”„ë¡œì íŠ¸ ì†Œê°œ    
> 1-1.  [í”„ë¡œì íŠ¸ ì†Œê°œ](#1-1-í”„ë¡œì íŠ¸-ì†Œê°œ)  
> 1-2.  [ê°œë°œ í™˜ê²½](#1-2-ê°œë°œ-í™˜ê²½)  
> 1-3.  [DB ëª¨ë¸ë§](#1-3-DB-ëª¨ë¸ë§)  
> 1-4.  [ì‹¤í–‰ ì˜ìƒ](#1-4-ì‹¤í–‰-ì˜ìƒ)  

### 2. í”„ë¡œì íŠ¸ ê¸°ëŠ¥
#### 2-1. ë¡œê·¸ì¸ ì„œë¹„ìŠ¤  
> 2-1-1. [ë¡œê·¸ì¸ì— ë”°ë¥¸ ê¶Œí•œ ì²˜ë¦¬](#2-1-1-ë¡œê·¸ì¸ì—-ë”°ë¥¸-ê¶Œí•œ-ì²˜ë¦¬)  
> 2-1-2. [OAuth2ë¥¼ ì´ìš©í•œ SNS ë¡œê·¸ì¸](#2-1-2-OAuth2ë¥¼-ì´ìš©í•œ-SNS-ë¡œê·¸ì¸)  
> 2-1-3. [ìë™ ë¡œê·¸ì¸](#2-1-3-ìë™-ë¡œê·¸ì¸)  
#### 2-2. ë¼ì´ë¸Œ ì„œë¹„ìŠ¤
> 2-2-1. [Nginx ì„¤ì •í•˜ê¸°](#2-2-1-Nginx-ì„¤ì •í•˜ê¸°)  
> 2-2-2. [Obs ì‚¬ìš©í•˜ê¸°](#2-2-2-Obs-ì‚¬ìš©í•˜ê¸°)  
> 2-2-3. [ë¼ì´ë¸Œ ì˜ìƒ ì¶œë ¥](#2-2-3-ë¼ì´ë¸Œ-ì˜ìƒ-ì¶œë ¥)  
> 2-2-4. [ffemegë¡œ ë¼ì´ë¸Œ ì˜ìƒ ì¶”ì¶œí•´ S3ì— ì˜¬ë¦¬ê¸°](#2-2-4-ffemegë¡œ-ë¼ì´ë¸Œ-ì˜ìƒ-ì¶”ì¶œí•´-S3ì—-ì˜¬ë¦¬ê¸°)  
> 2-2-5. [ë¼ì´ë¸Œ ì¢…ë£Œ í›„ ì¶”ì¶œí•œ ì˜ìƒ ë³´ì—¬ì£¼ê¸°](#2-2-5-ë¼ì´ë¸Œ-ì¢…ë£Œ-í›„-ì¶”ì¶œí•œ-ì˜ìƒ-ë³´ì—¬ì£¼ê¸°)
#### 2-3. ì±„íŒ… ì„œë¹„ìŠ¤
> 2-3-1. [ë¼ì´ë¸Œ ì±„íŒ…ë°©](#2-3-1-ë¼ì´ë¸Œ-ì±„íŒ…ë°©)  
> 2-3-2. [ì±„íŒ…ë°© ì¸ì›ìˆ˜ í‘œì‹œ](#2-3-2-ì±„íŒ…ë°©-ì¸ì›ìˆ˜-í‘œì‹œ)
#### 2-4. ì¥ë°”êµ¬ë‹ˆ 
> 2-4-1. [ì—…ì²´ë³„ í•©ê³„ ë° ë°°ì†¡ë¹„ ì²˜ë¦¬](#2-4-1-ì—…ì²´ë³„-í•©ê³„-ë°-ë°°ì†¡ë¹„-ì²˜ë¦¬)
#### 2-5. ê²°ì œ ì„œë¹„ìŠ¤
> 2-5-1. [ì•„ì„í¬íŠ¸ APIë¥¼ ì´ìš©í•œ ê²°ì œ ê¸°ëŠ¥](#2-5-1-ì•„ì„í¬íŠ¸-APIë¥¼-ì´ìš©í•œ-ê²°ì œ-ê¸°ëŠ¥)
#### 2-6. êµ¬ë§¤ë‚´ì—­
> 2-6-1. [êµ¬ë§¤ ìƒíƒœë³„ ìˆ˜ êµ¬í•˜ê¸°](#)
#### 2-7. íŒë§¤ì ê¸°ëŠ¥
> 2-7-1. [ìƒí’ˆ ë“±ë¡ ë° íŒë§¤ê¸€ ë“±ë¡](#2-7-1-ìƒí’ˆ-ë“±ë¡-ë°-íŒë§¤ê¸€-ë“±ë¡)  
> 2-7-2. [ë¼ì´ë¸Œ ë“±ë¡](#2-7-2-ë¼ì´ë¸Œ-ë“±ë¡)  
> 2-7-3. [íŒë§¤ë‚´ì—­ ê²°ì œ ë° ì£¼ë¬¸ìƒíƒœ](#2-7-3-íŒë§¤ë‚´ì—­-ê²°ì œ-ë°-ì£¼ë¬¸ìƒíƒœ)  

### 3. AWS
*** ì¶” í›„ ë¸”ë¡œê·¸ì— ì •ë¦¬í•  ì˜ˆì •
(https://github.com/onealog)

### 4. ë§ˆë¬´ë¦¬
> 3-1. ì•„ì‰¬ì› ë˜ ì / ì¢‹ì•˜ë˜ ì 
> 3-2. ë§ˆë¬´ë¦¬ ì†Œê°
---
---
# 1. í”„ë¡œì íŠ¸ ì†Œê°œ
## 1-1. í”„ë¡œì íŠ¸ ì†Œê°œ
* ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•´ë³´ê³  ì‹¶ì–´ì„œ ì²˜ìŒì—ëŠ” ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•´ë³¼ê¹Œ í•˜ë‹¤ ìµœê·¼ ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ê°€ í˜„ì¬ í° ê´€ì‹¬ ì¤‘ í•˜ë‚˜ë¼ ìƒê°í•˜ì—¬ ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ì›¹ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

* ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ì˜ ì¥ì ì¸ í¸ì˜ì„±ê³¼ ì†Œí†µì„±ì„ ìœ„í•´ ì‹¤ì‹œê°„ ì˜ìƒê³¼ ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì„ ë„£ì—ˆìœ¼ë©° ì‹¤ì‹œê°„ ë°©ì†¡ì´ ëë‚˜ë„ í•´ë‹¹ ì˜ìƒì„ ë‹¤ì‹œ ë³´ì—¬ì¤Œìœ¼ë¡œì¨ ì†Œë¹„ìì—ê²Œ ì§€ì†ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ì—¬ íš¨ìœ¨ì„±ì„ ì¦ëŒ€ì‹œì¼°ìŠµë‹ˆë‹¤.

* í˜¼ì ìƒˆë¡­ê²Œ ê¸°íší•˜ê³  ì œì‘í•˜ê¸°ì—” ë§ì€ ê¸°ê°„ì´ ì†Œìš”ë  ê²ƒ ê°™ì•„ì„œ ì›¹ ë””ìì¸ê³¼ ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ëŠ” ë„¤ì´ë²„ ì‡¼í•‘ ë¼ì´ë¸Œë¥¼ ê°œì¸ì ìœ¼ë¡œ ë¶„ì„í•´ í´ë¡  ì½”ë”© í•˜ì˜€ìœ¼ë©°, ì¥ë°”êµ¬ë‹ˆ, êµ¬ë§¤í˜ì´ì§€ëŠ” ì˜¤ëŠ˜ì˜ ì‡¼í•‘ ì›¹ ë””ìì¸ì„ ì°¸ê³  í•˜ì˜€ìŠµë‹ˆë‹¤.

## 1-2. ê°œë°œ í™˜ê²½ ğŸ›  
<img src="https://img.shields.io/badge/JAVA-FF4DAC?style=flat-square&logo=java&logoColor=white&width=300"> <img src="https://img.shields.io/badge/MySQL-B965DF?style=flat-square&logo=MySQL&logoColor=white"/> <img src="https://img.shields.io/badge/Spring Boot-758bfd?style=flat-square&logo=SpringBoot&logoColor=white"/> <img src="https://img.shields.io/badge/Spring Security-0083DE?style=flat-square&logo=Spring Security&logoColor=white"/> <img src="https://img.shields.io/badge/Apache Tomcat-21B88F?style=flat-square&logo=ApacheTomcat&logoColor=white"/> <img src="https://img.shields.io/badge/NGINX-007844?style=flat-square&logo=NGINX&logoColor=white"/>

<img src="https://img.shields.io/badge/FFmpeg-00BD8D?style=flat-square&logo=FFmpeg&logoColor=white"/> <img src="https://img.shields.io/badge/Socket.io-00B0D5?style=flat-square&logo=Socket.io&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon AWS-00A1FF?style=flat-square&logo=AmazonAWS&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon ECS-008CFF?style=flat-square&logo=Amazon ECS&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon S3-006BFF?style=flat-square&logo=Amazon S3&logoColor=white"/> 
<img src="https://img.shields.io/badge/Amazon RDS-4026FF?style=flat-square&logo=Amazon RDS&logoColor=white"/> 

<img src="https://img.shields.io/badge/HTML-FF911E?style=flat-square&logo=HTML5&logoColor=white"/> <img src="https://img.shields.io/badge/CSS3-FF7965?style=flat-square&logo=CSS3&logoColor=white"/> <img src="https://img.shields.io/badge/Javascript-FF4986?style=flat-square&logo=Javascript&logoColor=white"/> <img src="https://img.shields.io/badge/jQuery-FF26AC?style=flat-square&logo=jQuery&logoColor=white"/> <img src="https://img.shields.io/badge/Adobe Photoshop-B15AE9?style=flat-square&logo=Adobe Photoshop&logoColor=white"/> <img src="https://img.shields.io/badge/Adobe Illustrator-6E19DF?style=flat-square&logo=Adobe Illustrator&logoColor=white"/>

## 1-3. DB ëª¨ë¸ë§


## 1-4. ì‹¤í–‰ ì˜ìƒ

<br>

# 2. í”„ë¡œì íŠ¸ ê¸°ëŠ¥
## 2-1. ë¡œê·¸ì¸ ì„œë¹„ìŠ¤
### 2-1-1. WebSecurityConfig ì„¤ì •
Spring Securityì— ë‹¤ì–‘í•œ ë¡œê·¸ì¸ ë°©ë²• ì²˜ë¦¬ ì„¤ì •ì„ í•´ì¤€ë‹¤.
* form ë¡œê·¸ì¸
* ë¡œê·¸ì¸ ì„±ê³µ-ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ ë° í˜ì´ì§€ URL
* ìë™ ë¡œê·¸ì¸ 
* ë¡œê·¸ì•„ì›ƒ
* ë¡œê·¸ì¸ ì²˜ë¦¬ URL csrf ì˜ˆì™¸ì²˜ë¦¬
* OAuth2 ë¡œê·¸ì¸
```java
http.authorizeRequests()
      ...(URLì˜ ê¶Œí•œ ì„¤ì •)...
      .and()
        .formLogin()                                    // formíƒœê·¸ ê¸°ë°˜ì˜ ë¡œê·¸ì¸
        .usernameParameter("userId")                    // id íŒŒë¼ë¯¸í„° ëª…
        .passwordParameter("userPw")                    // pw íŒŒë¼ë¯¸í„° ëª…
        .loginPage("/login")                            // ë¡œê·¸ì¸ í˜ì´ì§€
        .loginProcessingUrl("/loginProcess")            // ë¡œê·¸ì¸ ì²˜ë¦¬ URL
        .failureUrl("/login?error=true")                // ë¡œê·¸ì¸ ì‹¤íŒ¨ í›„ í˜ì´ì§€
        .failureHandler(authenticationFailureHandler)   // ë¡œê·¸ì¸ ì‹¤íŒ¨ í•¸ë“¤ëŸ¬
        .successHandler(authenticationSuccessHandler)   // ë¡œê·¸ì¸ ì„±ê³µ í•¸ë“¤ëŸ¬
        .permitAll()
      .and()
        .rememberMe()                                   // ìë™ë¡œê·¸ì¸
        .rememberMeParameter("rememberMe")              // ìë™ë¡œê·¸ì¸ íŒŒë¼ë¯¸í„° ëª…
        .tokenValiditySeconds(86400 * 30)               // ì¿ í‚¤ ë§Œë£Œ ì‹œê°„ ì„¤ì •(30ì¼)
        .userDetailsService(customUsersDetailService)   // ì‹œìŠ¤í…œì˜ ì‚¬ìš©ì ê³„ì •ì„ ì¡°íšŒí•  ë•Œ ì²˜ë¦¬ ì„¤ì •í•˜ëŠ” api
        .tokenRepository(tokenRepository())             //DataSource ì¶”ê°€
      .and()
        .logout()                                       // ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ì„¤ì • ì§„ì…ì 
        .logoutUrl("/logout")                           // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ URL
        .logoutSuccessUrl("/")                          // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ ì…ë ¥í•œ ì£¼ì†Œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        .invalidateHttpSession(true)                    // ì„¸ì…˜ ì •ë³´ ì‚­ì œ
        .deleteCookies("JSESSIONID","rememberMe")       //ë¡œê·¸ì•„ì›ƒ í›„ ìë™ ë¡œê·¸ì¸ ì¿ í‚¤ ì‚­ì œ
        .permitAll()
      ...(ì„œë¸Œëª¨ë“ˆ iframe ì—ëŸ¬ ì²˜ë¦¬)...
      .and()
        .cors()                                         // ìì› ê³µìœ  ê¶Œí•œ ì²´ì œ
      .and()      
        .csrf()                                         //csrf ê³µê²©ì„ ë§‰ì•„ì£¼ëŠ” CsrfFilter ì œê³µ
        .ignoringAntMatchers("/loginProcess","/stomp/**")  // csrfì˜ˆì™¸ì²˜ë¦¬  
      .and()
        .oauth2Login()                                  //  OAuth2 ë¡œê·¸ì¸ ê¸°ëŠ¥ ì„¤ì • ì§„ì…ì 
        .loginPage("/login")
        .userInfoEndpoint()                             //  OAuth2 ë¡œê·¸ì¸ ì„±ê³µ ì´í›„ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¬ ì„¤ì • ë‹´ë‹¹
        .userService(customOAuth2UserService);          //  ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ í›„ ì²˜ë¦¬ êµ¬í˜„ì²´ ë“±ë¡
```
### 2-1-1. ë¡œê·¸ì¸ì— ë”°ë¥¸ ê¶Œí•œ ì²˜ë¦¬
* ìœ ì € ê¶Œí•œ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” enum í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³  DBì— ì €ì¥ëœ ìœ ì € ê¶Œí•œì˜ key ê°’ê³¼ ë¹„êµí•´ ìœ ì €ì˜ ê¶Œí•œ ê°’ì„ ë¶€ì—¬í•´ì¤€ë‹¤.
* ìë™ ë¡œê·¸ì¸ ì²˜ë¦¬ì‹œì—ë„ ì‚¬ìš©ëœë‹¤.

[UserRole.java] 
```java
@Getter
@RequiredArgsConstructor
public enum UserRole {
    MEMBER("ROLE_MEMBER","11","ì •íšŒì›"), 
    EMPLOYEE("ROLE_EMPLOYEE","12","ê¸°ì—…íšŒì›"),
    ADMIN("ROLE_ADMIN","13","ê´€ë¦¬ì"), 
    UNKNOWN("UNKNOWN","",""),
    STOP("ROLE_STOP","99","ë¸”ëŸ­ê³„ì •");
    
    private final String role;
    private final String key;
    private final String title;
    
    ...
}
```
* AuthProvider, CustomUsersDetailService
```java
   ... 

  /* ìœ ì € ê¶Œí•œ ì •ë³´ ë„£ê¸° */
  UserRole userRole =UserRole.fromRole(user.getUserRole());
  ArrayList<SimpleGrantedAuthority> authorities = new ArrayList<>();

  if(UserRole.MEMBER.getKey().equals(user.getUserRole())) {                         //UserRoleì˜ keyê°’ê³¼ DBì— ì €ì¥ëœ ìœ ì €ì˜ Role ê°’ì„ ë¹„êµí•´
      authorities.add(new SimpleGrantedAuthority(UserRole.MEMBER.getRole()));       //ì¼ì¹˜í•˜ëŠ” UserRole ê°’ì„ ë¶€ì—¬í•´ì¤€ë‹¤
  }else if(UserRole.EMPLOYEE.getKey().equals(user.getUserRole())) {
      authorities.add(new SimpleGrantedAuthority(UserRole.EMPLOYEE.getRole()));
  }else if(UserRole.ADMIN.getKey().equals(user.getUserRole())){
      authorities.add(new SimpleGrantedAuthority(UserRole.ADMIN.getRole()));
  }else if(UserRole.STOP.getKey().equals(user.getUserRole())) {
      authorities.add(new SimpleGrantedAuthority(UserRole.STOP.getRole()));
  }else{
      authorities.add(new SimpleGrantedAuthority(UserRole.UNKNOWN.getRole()));
  }
  
  user.setAuthorities(authorities);       // ë¶€ì—¬ ë°›ì€ Role ê°’ì€ UserVoì— ë„£ì–´ì¤€ë‹¤
  user.setUserPw(null);                   // ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ ê°’ì€ ë¹„ì›Œì¤€ë‹¤.
  ... 
```

### 2-1-2. OAuth2ë¥¼ ì´ìš©í•œ SNS ë¡œê·¸ì¸
* OAuth2UserServiceë¥¼ ìƒì† ë°›ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ ë¡œê·¸ì¸ í•˜ë ¤ëŠ” SNSì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ 
```
```
## 2-2.
* OBSì˜ ë°©ì†¡ ì„œë²„ë¥¼ ìœ„í•´ NGINX-RTMPë¥¼ ì‚¬ìš©í•˜ì˜€ìœ¼ë©° HTML5ì˜ Videoíƒœê·¸ë¡œ ìŠ¤íŠ¸ë¦¼ì„ ë°›ì•„ ì˜ìƒì„ ì¬ìƒì‹œí‚¬ ìˆ˜ ìˆê²Œ hls.jsë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
* ë¼ì´ë¸Œ ì˜ìƒì„ ì €ì¥í•´ ë¼ì´ë¸Œ ì¢…ë£Œ í›„ì—ë„ 
